---
title: "Workshop 8 TEMPLATE"
subtitle: "9 AM"
author: "Linda Herrera"
date: "2026-02-27"
format:
  html:
    toc: true # use this to display a table of contents
execute:
  message: false # use this to make sure messages don't show up
  warning: false # use this to make sure warnings don't show up
---

[deployed html url](https://herreralinda847.github.io/workshop-08_winter-2026/code/workshop-code.html)

In this workshop, we will answer the question: How do specific leaf area, water treatment, and species influence plant mass?

**Specific leaf area** is a continuous variable measured in cm^2^/g.

**Water treatment** is a categorical variable (i.e. a *factor*) with 2 levels: drought stressed (DS) and well watered (WW).

**Species** is a categorical variable (again, a *factor*) with 7 levels.

| Species name                 | Species code | Common name        |
|------------------------------|--------------|--------------------|
| *Encelia californica*        | ENCCAL       | Bush sunflower     |
| *Eschscholzia californica*   | ESCCAL       | California poppy   |
| *Penstemon centranthifolius* | PENCEN       | Scarlet bugler     |
| *Grindelia camporums*        | GRINCAM      | Gumweed            |
| *Salvia leucophylla*         | SALLEU       | Purple sage        |
| *Stipa pulchra*              | STIPUL       | Purple needlegrass |
| *Lotus scoparius*            | LOTSCO       | Deerweed           |

# 1. Set up

```{r}
#| label: packages and data

# read in your packages here
library(tidyverse) # general use
library(here) # file organization
library(janitor) # cleaning data frames
library(readxl) # reading excel files
library(scales) # modifying axis labels
library(ggeffects) # getting model predictions
library(MuMIn) # model selection

# read in your data here

drought_exp <- read_xlsx(
  path = here(
    "data", 
    "Valliere_etal_EcoApps_Data.xlsx"
    ), 
  sheet = "First Harvest"
)

```

```{r}
#| label: plot colors and aesthetics

# storing colors to use for species
lotsco_col <- "#E69512"
pencen_col <- "#D6264F"
salleu_col <- "#6D397D"
enccal_col <- "#3A5565"
stipul_col <- "#3F564F"
esccal_col <- "#515481"
gricam_col <- "#6C91BD"

# storing colors to use for water treatments
ds_col <- "#A62F03"
ww_col <- "#045CB4"

# storing a ggplot theme (that will be used for all ggplots)
theme_set(theme_bw())
```

# 2. Clean data

Data source: Valliere, Justin; Zhang, Jacqueline; Sharifi, M.; Rundel, Philip (2019). Data from: Can we condition native plants to increase drought tolerance and improve restoration success? \[Dataset\]. Dryad. <https://doi.org/10.5061/dryad.v0861f7>

```{r}
#| label: data cleaning

# creating a new object called 'drought_exp_clean'
drought_exp_clean <- drought_exp |> 
  # cleaning up column names
  clean_names() |> 
  # created new column called 'species_name' the full names of the plants
  mutate(species_name = case_match(
    species,
    "ENCCAL" ~ "Encelia californica", # bush sunflower
    "ESCCAL" ~ "Eschscholzia californica", # California poppy
    "PENCEN" ~ "Penstemon centranthifolius", # Scarlet bugler
    "GRICAM" ~ "Grindelia camporum", # Gumweed
    "SALLEU" ~ "Salvia leucophylla", # purple sage
    "STIPUL" ~ "Stipa pulchra", # purple needlegrass
    "LOTSCO" ~ "Lotus scoparius" # deerweed
  )) |> 
  # adding a column for treatment and changing abbreviations to corresponding with full names
  mutate(water_treatment = case_match(
    water,
    "WW" ~ "Well watered",
    "DS" ~ "Drought stressed"
  )) |> 
  # treating species name and treatments as a factor and seeting factor level order
  mutate(species_name = as_factor(species_name),
         species_name = fct_relevel(species_name,
                                    "Lotus scoparius",
                                    "Penstemon centranthifolius",
                                    "Salvia leucophylla",
                                    "Encelia californica",
                                    "Stipa pulchra",
                                    "Eschscholzia californica",
                                    "Grindelia camporum")) |> 
  mutate(water_treatment = as_factor(water_treatment),
         water_treatment = fct_relevel(water_treatment,
                                       "Drought stressed",
                                       "Well watered")) |> 
  # selecting columns of interest
  select(species_name, water_treatment, sla, total_g)
```

Insert code to double check the structure of the data frame here.

```{r}
#| label: checking structure 

str(drought_exp_clean)

```

Insert code to display 10 random rows from the data frame here.

```{r}
#| label: displaying rows in data frame

slice_sample(
  drought_exp_clean,
  n = 10
)

```

# 3. Visualizing data

## What is the relationship between SLA and plant mass?

Make a scatterplot to visualize SLA (the predictor) on the x-axis, and total mass (the response) on the y-axis.

Label the axes with units where appropriate.

Add a title describing the relationship (e.g. as SLA increases, total mass \_\_\_\_\_\_).

```{r}
#| label: ggplot

ggplot(data = drought_exp_clean,
       aes(x = sla,
           y = total_g)) + 
  # first layer: points to represent individual observations 
  geom_point(color = "tomato") + 
  # labeling the x- and y- axes
  labs(x = "Specific leaf area (cm\U00B2/g)",
       y = "Total mass",
       title = "As SLA increases, total mass increases")

```

## What are the differences in total mass between water treatments?

Make a jitterplot to visualize the differences in plant mass between water treatments.

Label the axes with units where appropriate.

Add a title describing the differences in (mean or median) plant mass between water treatments.

```{r}
#| label: water treatment and mass plot

ggplot(data = drought_exp_clean,
       aes(x = water_treatment,
           y = total_g,
           color = water_treatment)) + 
  geom_jitter(height = 0, 
              width = 0.3) +
  scale_color_manual(values = c(
    "Drought Stressed" = ds_col,
    "Well watered" = ww_col)) + 
  theme(legend.position = "none")
  labs(x = "Water treatment",
       y = "Total mass (g)",
       title = "On average plant mass is well watered treatment is higher than plant mass in drought stressed treatment") + 
  theme_minimal()

```

## What are the differences in total mass between species?

Make a jitterplot to visualize the differences in plant mass between species.

Label the axes with units where appropriate.

Add a title describing the differences in (mean or median) plant mass between species.

Bonus: order the x-axis by decreasing mean plant mass *and* wrap the long species names using the `label_wrap()` function from the `scales` package.

```{r}
#| label: species and plant mass plot 

ggplot(data = drought_exp_clean,
       aes(x = species_name, 
           y = total_g,
           color = species_name)) + 
  geom_jitter(height = 0, 
              width = 0.2) + 
  scale_color_manual(values = c(
     "Lotus scoparius" = lotsco_col,
     "Penstemon centranthifolius" = pencen_col,
     "Salvia leucophylla" = salleu_col,
     "Encelia californica" = enccal_col,
     "Stipa pulchra" = stipul_col,
     "Eschscholzia californica" = esccal_col,
     "Grindelia camporum" = gricam_col
  )) + 
  scale_x_discrete(labels = label_wrap(10)) + 
  labs(x = "Species name",
       y = "Total mass(g)",
       title = "Plant mass differs across species") + 
  theme(legend.position = "none")

```

# 4. Fitting models

8 models total:

| Model number | SLA | Water treatment | Species |       Predictor list        |
|--------------|:---:|:---------------:|:-------:|:---------------------------:|
| 0            |     |                 |         | no predictors (null model)  |
| 1            |  X  |        X        |    X    | all predictors (full model) |
| 2            |  X  |        X        |         |   SLA and water treatment   |
| 3            |  X  |                 |    X    |       SLA and species       |
| 4            |     |        X        |    X    | water treatment and species |
| 5            |  X  |                 |         |             SLA             |
| 6            |     |        X        |         |       water treatment       |
| 7            |     |                 |    X    |           species           |

## Model fitting

```{r}
#| label: model fitting

# model 0: null model
model0 <- lm(
  total_g ~ 1, # no predictors
  data = drought_exp_clean
)

# model 1: all predictors
model1 <- lm(
  total_g ~ sla + water_treatment + species_name, # saturated model
  data = drought_exp_clean
)

# model 2: SLA and water treatment
model2 <- lm(
  total_g ~ sla + water_treatment,
  data = drought_exp_clean
)

# model 3: SLA and species
model3 <- lm(
  total_g ~ sla + species_name, 
  data = drought_exp_clean
)

# model 4: water treatment and species
model4 <- lm(
  total_g ~ species_name + water_treatment,
  data = drought_exp_clean
)

# model 5: SLA
model5 <- lm(
  total_g ~ sla,
  data = drought_exp_clean
)

# model 6: water treatment
model6 <- lm(
  total_g ~ water_treatment,
  data = drought_exp_clean
)

# model 7: species
model7 <- lm(
  total_g ~ species_name,
  data = drought_exp_clean
)

```

## Model selection

Insert code to use the `AICc()` function to calculate the AIC for each model.

Arrange by decreasing AIC.

```{r}
#| label: model selection

AICc(
  model0,
  model1,
  model2,
  model3,
  model4,
  model5,
  model6,
  model7
) |>  
  arrange(AICc)


```

The best model to describe variation in plant mass only includes water treatment and species. 


## Model diagnostics

```{r}
#| label: checking diagnostics

par(mfrow = c(2, 2)) # display plots in a 2 x 2 grid
plot(model4) # model to check diagnostics

```

Diagnostic plots look good. 

Residuals (standing in for errors) look normally distributed based on QQ plot. 

Residuals look homoscedasic (have constant variance) 

No outliers inclufluencing model estimates of coefficents. 

## Summary

```{r}
#| label: looking at model summary

summary(model4)

```




Insert code to display the summary for the best model.

**What are the reference levels?**

Drought stressed and Lotus scoparius. 

**What does the `(Intercept)` represent?**

The intercept is the model prediction for plant mass for Lotus scoparius in the drought stressed treatment. The model predicts that Lotus scoparius mass in the drought stressed treatment will be 0.055 $/pm$ 0.025 (SE) g. 

**What does `water_treatmentWell watered` represent?**

This is the model prediction for the difference in Lotus scoparius mass between the well watered and drought stressed treatments, The model predicts that this difference is 0.12 $\pm$ 0.017 g. 

**What does `species_namePenstemon centranthifolius` represent?**

This is the model prediction for the difference between Penstemon centranthifolius mass in the well watered treatment and Lotus scoparius mass in the well watered treatment. The model preducts that this difference is 0.05 $\pm$ 0.03 g. 

**What does `species_nameEschscholzia californica` represent?**

This is the model prediction for the difference between Eschscholzia californica mass in the well watered treatment and Lotus scoparius mass is the well watered treatment. The model predicts that this difference is 0.23 $\pm$ 0.03 g. 

## Stop and think: what does this model mean?

**What is the best model?**

The best model includes water treatment and species as predictors. 

**How much variation in the response (total mass, in grams) does this model explain?**

72% of the variation in plant mass can be explained by this model. 

**How do we interpret the effects of the predictors on the response variable (again, total mass in grams)?**

Treatment influences plant mass. 

Species influences plant mass. 

# 4. Model predictions

Insert code to generate model predictions for the best model.

Rename the `x` column and `group` column to match the original data frame (`drought_exp_clean`).

Look at the object before plotting.

```{r}
#| label: generate predictions

preds <- ggpredict(
  model4,
  terms = c("water_treatment", "species_name")
) |>  
  rename(water_treatment = x,
         species_name = group)

```


# 5. Final figure

Create a clean, publication ready figure depicting predictions for the best model and the underlying data.

```{r}
#| label: final figure
#| fig-height: 6
#| fig-width: 12

ggplot(data = drought_exp_clean,
       aes(x = water_treatment,
           y = total_g)) + 
  geom_jitter(height = 0, 
              width = 0.3,
              alpha = 0.5,
              shape = 21) +
  geom_pointrange(data = preds, 
                  aes(x = water_treatment,
                      y = predicted, 
                      ymin = conf.low,
                      ymax = conf.high)) +
  scale_color_manual(values = c(
    "Drought Stressed" = ds_col,
    "Well watered" = ww_col)) + 
  labs(x = "Water treatment",
       y = "Total mass (g)") +
    facet_wrap(~ species_name,
               nrow = 1) +
  theme(legend.position = "none") 
  




```







# 6. Writing

## Figure caption

## Basic components of test

**predictors**

**response**

**test**

**distribution**

**parameters (degrees of freedom)**

**test statistic**

**R^2^**

**p-value**

**significance level**

**reference level(s)**

## Written communication

### Methods

#### Goal of analysis

#### Model selection

#### Model diagnostics

### Results
